<!--
  * Based on Jamie Wong's demo:
  * http://jamie-wong.com/2016/07/06/metaballs-and-webgl/#step-1-running-a-fragment-shader-for-every-pixel-on-the-screen
-->

<!DOCTYPE HTML>
<html>

<head>
  <title>WebGL Demo - Hello World</title>
  <meta charset="utf-8">
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>

  <script src="./libraries/threejs/three.min.js"></script>
  <!-- shaders -->
  <script type="x-shader/x-vertex" id="vertexshader">
    //varying vec3 vUv;
    void main() {
      //vUv = position;

      vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * modelViewPosition;
    }
  </script>
  <script type="x-shader/x-fragment" id="fragmentshader">
    //varying vec3 vUv;
    void main() {
      gl_FragColor = vec4(gl_FragCoord.x / 500.0,
                          gl_FragCoord.y / 400.0,
                          0.0,
                          1.0);
    }
  </script>
</head>

<body></body>

<script>
  main();

  function main() {
    const scene = new THREE.Scene();

    // 2D perspective camera -- see linked article on top for full explanation of params
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 100);
    camera.position.set(0, 0, 3);
    camera.lookAt(scene.position);
    scene.add(camera);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setClearColor(0x000000, 1);
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);


    let uniforms = {
      // colorB: {type: 'vec3', value: new THREE.Color(0x00FF00)},
    };
    let vShader = document.getElementById("vertexshader").innerText;
    let fShader = document.getElementById("fragmentshader").innerText;

    // setup our triangle (via vertices and faces)
    let triangleGeom = new THREE.BufferGeometry();
    let points = [];

    // right hand rule!
    points.push(new THREE.Vector3(-1.0, 1.0, 0.0));
    points.push(new THREE.Vector3(-1.0, -1.0, 0.0));
    points.push(new THREE.Vector3(1.0, -1.0, 0.0));

    points.push(new THREE.Vector3(1.0, 1.0, 0.0));
    points.push(new THREE.Vector3(-1.0, 1.0, 0.0));
    points.push(new THREE.Vector3(1.0, -1.0, 0.0));

    triangleGeom.setFromPoints(points);
    triangleGeom.computeVertexNormals();

    // give it a material
    let triangleMat = new THREE.ShaderMaterial({
      uniforms: uniforms,
      fragmentShader: fShader,
      vertexShader: vShader,
    });

    // and now create the mesh (geom+mat)
    let triangleMesh = new THREE.Mesh(triangleGeom, triangleMat);
    triangleMesh.position.set(0, 0, 0);//-1.5, 0.0, 4.0);
    scene.add(triangleMesh);

    renderer.render(scene, camera);

  }

</script>

</html>